`$ vault operator unseal`

Unseal Key 1: b74Sfpzb9KL3ClHh5lNvRHlhnKwFW3X0htUAJbdi78E=

`$ vault login`
vault | Initial Root Token: hvs.cz4lKw5Dkbqazrm7OhCIXrZ7
vault | Admin Token:
`$ vault logout`

When creating new policy we need to generate a vault token and attach it to the policy
`$ vault policy write my-policy vault/config/my-policy.hcl`
`$ vault token create -policy=my-policy`
`$ vault login (my-policy-token)`

`$ vault secrets enable database`

```s
$ vault write database/config/postgresql \
        plugin_name=postgresql-database-plugin \
        allowed_roles="dbuser" \
        connection_url="postgresql://{{username}}:{{password}}@postgres/handouceur" \
        username="vault" \
        password="vault-password"
```

Seems not required
`$ vault write -force database/rotate-root/postgresql`

Create a "dbuse" Vault role that will manage the credential creation in both Vault & Postgres.

```s
$ vault write database/roles/dbuser \
        db_name="postgresql" \
        creation_statements="CREATE USER \"{{name}}\" WITH SUPERUSER ENCRYPTED PASSWORD '{{password}}' VALID UNTIL '{{expiration}}'; GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO \"{{name}}\";" \
        revocation_statements="REVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA public FROM \"{{name}}\"; DROP OWNED BY \"{{name}}\"; DROP ROLE \"{{name}}\";" \
        default_ttl=1h \
        max_ttl=24h
```

Show Credentials
`$ vault read database/creds/dbuser`

(
The username here is the one configured in postgres

```s
 $ vault write database/static-roles/db \
        db_name=postgresql \
        rotation_statements=@rotation.sql \
        username="vault" \
        rotation_period=86400
```

Check
`$ vault read database/static-roles/db`
Get the password generated by vault
`$ vault read database/static-creds/db`
)

Rotate the password
`$ vault write -f database/rotate-role/db`

`$ vault token create -policy="apps" -format json`
{
"client_token": "hvs.CAESILZ76aM0y3tniFInH_mam3_pCO_zCdk8w7rQPxknUufUGh4KHGh2cy5qM2U2bElOYlp3WnJzcW5ZVXMyVXRpalE",
"accessor": "Pr79RawOXa3imzJFKNNZ5ToY"
}

Certs
`openssl req -x509 -batch -nodes -newkey rsa:2048 -keyout selfsigned.key -out selfsigned.crt -config path/to/cert.conf -days 9999`
